@model NMT.Models.Topic
@{
    ViewData["Title"] = "Редагувати тему";
    Layout = "_Layout";
}

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-12 col-xl-11">
            <div class="card shadow-lg rounded-4">
                <div class="card-body p-4">
                    <h2 class="text-center text-warning mb-4">✏️ Редагувати тему</h2>

                    <form asp-action="Edit" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="Id" />

                        <!-- Назва теми -->
                        <div class="mb-3">
                            <label asp-for="Name" class="form-label fw-semibold">Назва теми</label>
                            <input asp-for="Name" class="form-control shadow-sm" />
                            <span asp-validation-for="Name" class="text-danger small"></span>
                        </div>

                        <!-- Розділ -->
                        <div class="mb-4">
                            <label asp-for="SectionId" class="form-label fw-semibold">Розділ</label>
                            <select asp-for="SectionId" class="form-select shadow-sm" asp-items="ViewBag.Sections">
                                <option value="">-- оберіть розділ --</option>
                            </select>
                            <span asp-validation-for="SectionId" class="text-danger small"></span>
                        </div>

                        <!-- Теорія -->
                        <div class="mb-5">
                            <label class="form-label fw-semibold">Теоретичний матеріал</label>
                            <div id="quill-container" style="height: 300px;" class="shadow-sm bg-white rounded"></div>
                            <input type="hidden" asp-for="TheoryHtml" id="TheoryHtml" />
                            <span asp-validation-for="TheoryHtml" class="text-danger small"></span>
                        </div>

                        <button type="submit" class="btn btn-warning w-100 py-2 fw-bold">
                            ✅ Зберегти зміни
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quill Snow + KaTeX стилі -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
<link href="https://cdn.quilljs.com/1.3.6/quill.katex.css" rel="stylesheet" />

<!-- KaTeX core styles & scripts + auto-render -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" />
<script defer
        src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js"></script>

<!-- Quill.js -->
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 1) Ініціалізуємо Quill з можливістю formula
        var quill = new Quill('#quill-container', {
            theme: 'snow',
            placeholder: 'Редагуйте теоретичний матеріал тут...',
            modules: {
                formula: true,
                toolbar: [
                    [{ header: [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    ['blockquote', 'code-block'],
                    [{ list: 'ordered' }, { list: 'bullet' }],
                    ['link', 'image', 'formula'],
                    ['clean']
                ]
            }
        });

        // 2) Підтягуємо існуючий HTML у редактор
        var existing = document.querySelector('#TheoryHtml').value;
        if (existing) {
            quill.root.innerHTML = existing;
        }

        // 3) Перед сабмітом форми — зберігаємо оновлений HTML
        document.querySelector('form').addEventListener('submit', function () {
            document.querySelector('#TheoryHtml').value = quill.root.innerHTML;
        });
    });
</script>
